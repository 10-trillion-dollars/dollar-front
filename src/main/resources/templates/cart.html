<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8">
  <title>장바구니</title>
</head>
<body>
<h2>장바구니</h2>
<div id="cartItems">
  <!-- JavaScript를 사용하여 장바구니 항목을 동적으로 렌더링 -->
</div>
<form action="/placeOrder" method="post">
  <select name="addressId" id="addressSelect">
    <option value="">배송 주소를 선택해주세요</option>
    <option th:each="address : ${addresses}" th:value="${address.id}" th:text="${address.fullAddress}"></option>
  </select>
  <!-- 장바구니 아이템 정보를 숨겨진 필드로 추가하거나, 자바 스크립트를 사용해 동적으로 폼 데이터를 구성할 수 있습니다. -->
  <button type="submit">주문하기</button>
</form>

<script>
  document.addEventListener('DOMContentLoaded', function() {
    displayCartItems();

    document.getElementById('placeOrderBtn').addEventListener('click', function() {
      const selectedAddressId = document.getElementById('addressSelect').value;
      if (selectedAddressId) {
        placeOrder(selectedAddressId);
      } else {
        alert('배송 주소를 선택해주세요.');
      }
    });
  });

  function displayCartItems() {
    const cartItems = JSON.parse(localStorage.getItem('cart')) || [];
    let total = 0;
    const cartItemsContainer = document.getElementById('cartItems');
    cartItemsContainer.innerHTML = '';

    cartItems.forEach((item) => {
      const itemElement = document.createElement('div');
      itemElement.innerHTML = `
      <img src="${item.productPhoto}" alt="${item.productName}" style="width: 100px; height: auto;">
      <p>${item.productName}</p>
      <p>가격: ${item.productPrice}원</p>
      <p>수량: ${item.quantity}</p>
      <p>합계: ${item.productPrice * item.quantity}원</p>
    `;
      cartItemsContainer.appendChild(itemElement);
      total += item.productPrice * item.quantity;
    });

    document.getElementById('totalPrice').textContent = `총 가격: ${total}원`;
  }

  function placeOrder(addressId) {
    // 주문 로직 구현
    console.log('주문이 처리되었습니다. 배송 주소 ID:', addressId);
    // 서버에 주문 정보를 전송하는 코드를 여기에 구현합니다.
  }
</script>
</body>
</html>
